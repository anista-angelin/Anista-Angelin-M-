import socket
import datetime
import os

# Common ports to scan
COMMON_PORTS = {
    21: "FTP (Insecure)",
    22: "SSH",
    23: "Telnet (Insecure)",
    25: "SMTP",
    53: "DNS",
    80: "HTTP",
    110: "POP3",
    143: "IMAP",
    443: "HTTPS",
    3306: "MySQL"
}

def scan_ports(target):
    open_ports = []

    print("\nScanning target:", target)
    print("Please wait...\n")

    for port, service in COMMON_PORTS.items():
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(1)
            result = sock.connect_ex((target, port))

            if result == 0:
                open_ports.append((port, service))
                print(f"[OPEN] Port {port} - {service}")

            sock.close()
        except:
            pass

    return open_ports


def generate_report(target, open_ports):
    filename = "scan_report.txt"

    try:
        with open(filename, "w") as report:
            report.write("VULNERABILITY SCAN REPORT\n")
            report.write("-------------------------\n")
            report.write(f"Target: {target}\n")
            report.write(f"Scan Date: {datetime.datetime.now()}\n\n")

            if open_ports:
                report.write("Open Ports Found:\n")
                for port, service in open_ports:
                    report.write(f"- Port {port}: {service}\n")

                report.write("\nSecurity Observations:\n")
                for port, service in open_ports:
                    if "Insecure" in service:
                        report.write(f"- Warning: {service} detected on port {port}\n")
            else:
                report.write("No open ports detected.\n")

            report.write("\nRecommendations:\n")
            report.write("- Close unused ports\n")
            report.write("- Disable insecure services like FTP and Telnet\n")
            report.write("- Keep software and services updated\n")

        print(f"\nReport generated successfully: {filename}")

    except PermissionError:
        print("\nERROR: Permission denied while creating report file.")
        print("Try running the program in a writable folder.")


def main():
    print("=== Simple Vulnerability Scanner ===")
    target = input("Enter target IP or domain (example: 127.0.0.1): ")

    open_ports = scan_ports(target)
    generate_report(target, open_ports)


if __name__ == "__main__":
    main()
